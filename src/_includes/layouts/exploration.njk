{% extends "layouts/base.njk" %}

{% block content %}

{# Find the current exploration from the collection based on page.fileSlug #}
{% set current = collections.explorationsWithLogs
    | selectattr("data.slug", "equalto", page.fileSlug)
    | first %}

    <pre>
page.slug: {{ page.slug }}
page.fileSlug: {{ page.fileSlug }}
page.url: {{ page.url }}
</pre>

<pre>
Explorations in collection with slugs:
{% for e in collections.explorationsWithLogs %}
- {{ e.data.title }} => {{ e.data.slug }}
{% endfor %}
</pre>

<div class="exploration-page">
  {% if current %}
    <h1>{{ current.data.title or "Untitled Exploration" }}</h1>

    <p><strong>Status:</strong> {{ current.data.status or "unknown" }}</p>
    <p><strong>Tags:</strong> {{ current.data.tags | default([]) | join(", ") }}</p>
    <p><strong>Started:</strong> {{ current.data.startDate | toStringDate }}</p>
    <p><strong>Last update:</strong> {{ current.data.latestUpdate | toStringDate }}</p>

    <h2>Overview</h2>
    <div class="overview">
      {{ current.data.description or "" | safe }}
    </div>

    <h2>Logs</h2>
    {% if current.data.relatedLogs and current.data.relatedLogs | length %}
      {% for log in current.data.relatedLogs %}
        <div class="log-entry {% if log.data.tags and "what-i-broke" in log.data.tags %}log-broke{% endif %}">
          <h3>{{ log.data.title }}</h3>
          <p><strong>Date:</strong> {{ log.data.date | toStringDate }}</p>
          <p><strong>Tags:</strong> {{ log.data.tags | default([]) | join(", ") }}</p>
          <p><strong>Status:</strong> {{ log.data.status }}</p>
          <div class="log-content">
            {{ log.templateContent | safe }}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p>No logs available yet.</p>
    {% endif %}

    {# Lingering questions #}
    {% if current.data.unansweredQuestions %}
      <section>
        <h3>Lingering questions</h3>
        <ul>
          {% if current.data.unansweredQuestions is string %}
            <li>{{ current.data.unansweredQuestions }}</li>
          {% else %}
            {% for question in current.data.unansweredQuestions %}
              <li>{{ question }}</li>
            {% endfor %}
          {% endif %}
        </ul>
      </section>
    {% endif %}

    {# References #}
    {% if current.data.references %}
      <section>
        <h3>References</h3>
        <ul>
          {% for reference in current.data.references %}
            <li>{{ reference }}</li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}

    {# Reflections #}
    {% if current.data.reflections %}
      <section>
        <h3>Reflections</h3>
        <ul>
          {% for reflection in current.data.reflections %}
            <li>{{ reflection }}</li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}

    {# Tools #}
    {% if current.data.tools %}
      <section>
        <h3>Tools</h3>
        <ul>
          {% for tool in current.data.tools %}
            <li>{{ tool }}</li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}

  {% else %}
    Exploration not found for slug: {{page.fileSlug}}
  {% endif %}
</div>

{% endblock %}
