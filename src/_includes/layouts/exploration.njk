{% extends "layouts/base.njk" %}

{% block content %}
  {# match and add log entries in desc. order based on current page #}
  {% set currentSlug = page.fileSlug %}
  {% set relatedLogs = [] %}

    {% for log in collections.explorationLogs%}
      {% if log.data.parent == currentSlug %}
        {% set relatedLogs = relatedLogs | push(log) | reverse %}
      {% endif %}
    {% endfor%}

  {# update last update and status #}
  {% if relatedLogs | length %}
    {% set latestUpdate = relatedLogs[0].data.date %}
    {% set latestStatus = relatedLogs[0].data.status %}
  {% else %}
    {% set latestUpdate = startDate %}
    {% set latestStatus = status %}
  {% endif %}

  {# get tags #}
  {% set allTags = tags %}
  {% for log in relatedLogs %}
    {% for tag in log.data.tags %}
      {% if tag != "logs" and not (tag in allTags) %}
        {% set allTags = allTags | push(tag) %}
      {% endif %}
    {% endfor %}
  {% endfor %}

<article class="exploration">
  <h1>{{ title }}</h1>
  <p>Status: {{ latestStatus }}</p>
  <p>Tags: {{ allTags | join(", ") }}</p>
  <p>Started: {{ startDate | toStringDate }}</p>
  <p>Last update: {{ latestUpdate | toStringDate }}</p>

  <section>
    <h2>Overview</h2>
    {{ content | safe }}
  </section>

  <section>
  <h2>Logs</h2>
  <pre>Current page slug: {{currentSlug}}</pre>

  {% for log in relatedLogs %}
    <pre>{{log.data.title}}</pre>
    <pre>{{log.data.date | toStringDate}}</pre>
    <pre>{{log.data.underTitle}}</pre>
    <pre>tags: {{log.data.tags | join(", ")}}</pre>
    <pre>status: {{log.data.status}}</pre>
    <div>{{log.templateContent | safe}}</div>
    <hr />
  {% endfor %}
  </section>


  {# Lingering questions #}
  {% if unansweredQuestions %}
  <section>
    <h3>Lingering questions</h3>
    <ul>
      {% if unansweredQuestions is string %}
        <li>{{ unansweredQuestions }}</li>
      {% else %}
        {% for question in unansweredQuestions %}
          <li>{{ question }}</li>
        {% endfor %}
      {% endif %}
    </ul>
  </section>
  {% endif %}

  {# References #}
  {% if references %}
  <section>
    <h3>References</h3>
    <ul>
      {% for reference in references %}
        <li>{{ reference }}</li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}

  {# Reflections #}
  {% if reflections %}
  <section>
    <h3>Reflections</h3>
    <ul>
      {% for reflection in reflections %}
        <li>{{ reflection }}</li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}

  {# Tools #}
  {% if tools %}
  <section>
    <h3>Tools</h3>
    <ul>
      {% for tool in tools %}
        <li>{{ tool }}</li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}


{% endblock %}
